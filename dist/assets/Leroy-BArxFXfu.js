import{t as ee}from"./toolbar-D-ATlZDu.js";import{u as te,r as c,d as oe,e as se,c as h,a as r,w as p,F as ae,i as le,f,o as u,g as i,s as re,b as x,h as N,j as R,k as m,l as y,n as O,m as ne,t as P,p as B}from"./index-CcguAPKR.js";import{g as ie,f as de,s as ce,C as ue,_ as pe,R as ve,a as ge,b as M,u as A}from"./utils-CWdKvU7T.js";/* empty css                                                                     */const me={class:"flex flex-wrap items-center justify-between gap-5"},ye={class:"flex flex-wrap items-center justify-between gap-5"},_e={key:0},ke=["href"],fe={key:1,class:"flex items-center justify-between",style:{width:"100%","text-align":"center"}},we={style:{"flex-grow":"1","text-align":"center"}},he=["href","title"],xe={style:{"white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden",width:"20rem"}},q=48,Pe={__name:"Leroy",setup(be){te();const C=le("base_url"),z=c([]),U=c({}),n=c([]),E=c(0),G=c(new Array(10).fill({})),T=c(1),g=c(!1),$=c(!1),D=oe(),L=c(null),j=c(1);c(!1);const w=c([]),V=c(!1),J=a=>{a!=!1&&(w.value=[],a.products.forEach(o=>{const s=n.value.findIndex(d=>d.order_id===o.order_id);s!==-1&&(n.value[s].state_progress=o.state_progress)}))},K=()=>{V.value=!0},Y=a=>{L.value=a.sortField,j.value=a.sortOrder,g.value||n.value.sort((t,o)=>{const s=t[a.sortField],d=o[a.sortField];let v=0;return s>d?v=1:s<d&&(v=-1),a.sortOrder*v})},H=async a=>{const{newData:t,index:o}=a,s=n.value[o];if(s.link!==t.link){const d=s.sku,v=t.link,b=s.order_id,S=t.state_progress,_=await A(C,d,S,b,v);n.value[o].link=_.link,n.value[o].state_progress=_.state_progress}if(s.state_progress!==t.state_progress){const d=s.sku,v=s.order_id,b=t.link,S=t.state_progress,_=await A(C,d,S,v,b);n.value[o].link=_.link,n.value[o].state_progress=_.state_progress}},Q=async(a,t)=>{try{const o=await fetch(`${C}/links/GoodSn`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({link:t,order_id:a}),credentials:"include"});if(o.redirected||o.status===302||o.status===401){window.location.href="/login";return}if(!o.ok)throw new Error("Erro ${response.status}: Não foi possível atualizar o link.");const s=await o.json();return console.log(s),s;console.log("Link atualizado com sucesso:",s)}catch(o){console.error("Erro ao atualizar o link:",o)}};async function F(a){g.value=!0;const t=ie(`page_cache_leroy_${a}`,1e4);if(t){n.value=t.products,E.value=t.totalRecords,g.value=!1;return}const o=await de(a,C,q,"leroy");n.value=o.products.map(s=>({...s,created_date:new Date(s.created_date).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})),E.value=o.total_records||0,console.log(n.value),ce(`page_cache_leroy_${a}`,{products:n.value,totalRecords:E.value}),console.log("Dados salvos no cache"),g.value=!1}async function I(a){const t=a.link,o=a.order_id;try{const s=await Q(o,t),d=n.value.findIndex(v=>v.order_id===a.order_id);d!==-1&&(n.value[d].stock=s.stock,n.value[d].state_progress=s.state_progress,D.add({severity:"success",summary:"Stock Atualizado",detail:`O stock foi atualizado para ${s.stock}`,group:"br",life:3e3}))}catch(s){D.add({severity:"error",summary:"Erro ao Atualizar Stock",detail:s,group:"br",life:3e3})}}const W=a=>{T.value=a.page+1,F(T.value)},X=()=>{F(T.value)};se(()=>{F(1)});const Z=c([{label:"Pedido Novo",value:1},{label:"Em preparo",value:2},{label:"Encomenda Feita",value:3},{label:"Aguardando Tracking",value:4},{label:"Concluído",value:5},{label:"Sem Estoque",value:6},{label:"Reembolsado",value:7},{label:"Cancelado",value:8},{label:"Tracking Fake",value:9},{label:"Encomenda Fake",value:10}]);return(a,t)=>{const o=f("Skeleton"),s=f("Select"),d=f("InputText"),v=f("Card"),b=f("Toast"),S=f("ConfirmDialog"),_=f("ScrollTop");return u(),h(ae,null,[r(ee),r(ue,{route:"leroy"}),r(v,{style:{margin:"auto 1.5rem"}},{content:p(()=>[r(i(re),{expandedRows:U.value,"onUpdate:expandedRows":t[3]||(t[3]=e=>U.value=e),editingRows:z.value,"onUpdate:editingRows":t[4]||(t[4]=e=>z.value=e),value:g.value?G.value:n.value,onSort:Y,sortField:L.value,sortOrder:j.value,collapsedRowIcon:"pi pi-angle-down",expandedRowIcon:"pi pi-angle-up",dataKey:"order_id",editMode:"row",onRowEditSave:H,paginator:!0,rows:q,totalRecords:E.value,lazy:!0,size:"normal",removableSort:"",onPage:W,selection:w.value,"onUpdate:selection":t[5]||(t[5]=e=>w.value=e),pt:{cell:{style:"padding: 0 !important"},column:{bodycell:({state:e})=>e.loading?{style:"opacity: 0.5"}:{}}}},{header:p(()=>[x("div",me,[t[6]||(t[6]=x("div",{class:"flex flex-wrap items-center justify-between gap-5"},[x("span",{class:"text-xl font-bold"},"Pedidos LEROY")],-1)),x("div",ye,[w.value&&w.value.length>0?(u(),h("div",_e,[r(i(N),{onClick:K,severity:"contrast",label:"Enviar Encomenda",size:"small",rounded:"",outlined:""}),r(pe,{route:"leroy",visible:V.value,"onUpdate:visible":t[0]||(t[0]=e=>V.value=e),data:w.value,onUpdateData:J},null,8,["visible","data"])])):R("",!0),r(i(N),{icon:"pi pi-refresh",severity:"contrast",size:"small",rounded:"",raised:"",onClick:X})])])]),expansion:p(({data:e})=>[r(ve,{data:e},null,8,["data"])]),default:p(()=>[r(i(m),{selectionMode:"multiple",headerStyle:"width: 3rem"}),r(i(m),{expander:"",style:{width:"3rem"}}),r(i(m),{field:"state",header:"State",style:{width:"3%"}},{body:p(({data:e,field:l})=>[g.value?(u(),y(o,{key:0,style:{margin:"2px"}})):(u(),h("i",{key:1,class:O(i(ge)(e[l]))},null,2))]),_:1}),r(i(m),{field:"state_progress",header:"Progresso",sortable:"",style:{"min-width":"175px","max-width":"190px",width:"180px","align-self":"center"}},{body:p(({data:e,field:l})=>[g.value?(u(),y(o,{key:0,style:{margin:"2px"}})):(u(),y(i(B),{key:1,class:O(i(M)(e[l],2)),onClick:k=>I(e)},{default:p(()=>[ne(P(i(M)(e[l],1)),1)]),_:2},1032,["class","onClick"]))]),editor:p(({data:e,field:l})=>[e[l]!=null?(u(),y(s,{key:0,modelValue:e[l],"onUpdate:modelValue":k=>e[l]=k,options:Z.value,optionLabel:"label",optionValue:"value",placeholder:"Selecione o status",style:{margin:"2px"}},null,8,["modelValue","onUpdate:modelValue","options"])):R("",!0)]),_:1}),r(i(m),{field:"order_id",header:"Order ID",sortable:"",style:{"min-width":"175px","max-width":"790px",width:"680px","align-self":"center"}},{body:p(({data:e,field:l})=>[g.value?(u(),y(o,{key:0,style:{margin:"2px"}})):(u(),h("a",{key:1,href:`https://adeo-marketplace.mirakl.net/mmp/shop/order/${e[l]}`,target:"_blank",rel:"noopener noreferrer"},P(e[l]),9,ke))]),_:1}),r(i(m),{field:"stock",header:"Stock",sortable:"",style:{width:"5px","align-self":"center"}},{body:p(({data:e,field:l})=>[g.value?(u(),y(o,{key:0,style:{margin:"20px"}})):e[l]!=null?(u(),h("div",fe,[x("span",we,P(e[l]),1),r(i(B),{icon:"pi pi-fw pi-sync",severity:"Primary",rounded:"",style:{cursor:"pointer","text-align":"center",margin:"0 5px","background-color":"white",transition:"background-color 0.3s"},onClick:k=>I(e),onMouseover:t[1]||(t[1]=k=>$.value=!0),onMouseleave:t[2]||(t[2]=k=>$.value=!1),class:O({"tag-hover":$.value})},null,8,["onClick","class"])])):R("",!0)]),_:1}),r(i(m),{field:"link",header:"Link",bodyStyle:"text-align:end",style:{width:"20rem"}},{body:p(({data:e,field:l})=>[g.value?(u(),y(o,{key:0,style:{margin:"2px"}})):e[l]?(u(),h("a",{key:1,href:e[l],target:"_blank",class:"link",title:e[l]},[x("p",xe,P(e[l]),1)],8,he)):R("",!0)]),editor:p(({data:e,field:l})=>[e[l]!=null?(u(),y(d,{key:0,modelValue:e[l],"onUpdate:modelValue":k=>e[l]=k,fluid:""},null,8,["modelValue","onUpdate:modelValue"])):R("",!0)]),_:1}),r(i(m),{rowEditor:!0,style:{width:"6.5rem"},bodyStyle:"text-align:end"})]),_:1},8,["expandedRows","editingRows","value","sortField","sortOrder","totalRecords","selection","pt"])]),_:1}),r(b,{position:"bottom-right",group:"br"}),r(S),r(_,{severity:"contrast"})],64)}}};export{Pe as default};

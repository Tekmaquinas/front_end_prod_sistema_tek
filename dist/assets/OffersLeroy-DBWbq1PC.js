import{t as Y}from"./toolbar-D-ATlZDu.js";import{r as m,d as Z,e as ee,c as v,a as r,b as _,w as p,F as P,i as te,f as h,o as l,g as y,s as oe,h as D,k as w,l as k,t as g,p as se,n as ae,j as V}from"./index-CcguAPKR.js";/* empty css                                                                     */const ne={class:"flex flex-wrap items-center justify-between gap-5",style:{margin:"auto 1.5rem"}},re={key:0},le={class:"flex flex-wrap items-center justify-between gap-5"},ie={class:"flex flex-wrap items-center justify-between gap-5"},ce={class:"flex flex-wrap items-center justify-between gap-1"},de={class:"flex flex-wrap items-center justify-between gap-5"},ue=["src","alt"],pe=["href"],fe={style:{margin:"1px","font-size":"small","font-stretch":"condensed"},class:"text-surface-500 dark:text-surface-100",rounded:""},me={style:{margin:"1px","font-size":"small","font-stretch":"condensed"},class:"text-surface-500 dark:text-surface-100",rounded:""},ye={key:1},_e={key:1},ve={key:1,style:{"font-weight":"600",color:"rgba(20, 150, 36, 0.7)"}},he={key:1},ge={key:1,class:"flex items-center justify-between",style:{width:"100%","text-align":"center"}},we={style:{"flex-grow":"1","text-align":"center"}},N=20,$e={__name:"OffersLeroy",setup(ke){const S=te("base_url"),i=m([]),x=m(0),U=m(new Array(10).fill({})),$=m(1),d=m(!1),E=m(!1),C=m(""),O=Z(),T=m(null),j=m(1),z=m("Ofertas"),A=m(["Ofertas","Atualizador"]),B=t=>{T.value=t.sortField,j.value=t.sortOrder,d.value||i.value.sort((e,a)=>{const o=e[t.sortField],n=a[t.sortField];let c=0;return o>n?c=1:o<n&&(c=-1),t.sortOrder*c})},L=async(t,e,a)=>{try{const o=await fetch(`${S}/offers/GoodSn`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({link:t,sku:e,ean:a}),credentials:"include"});if(o.redirected||o.status===302||o.status===401){window.location.href="/login";return}if(!o.ok)throw new Error("Erro ${response.status}: Não foi possível atualizar o link.");const n=await o.json();return console.log(n),n}catch(o){console.error("Erro ao atualizar o link:",o)}};async function b(t){d.value=!0;const e=G(t,1e4);if(e){console.log("Carregando dados do cache"),i.value=e.products,x.value=e.totalRecords,d.value=!1;return}const a=await fetch(`${S}/offers?page=${t}&limit=${N}&marketplace=leroy`,{method:"GET",credentials:"include"});if(a.redirected||a.status===302||a.status===401){window.location.href="/login";return}if(!a.ok)throw new Error("Erro ao buscar produtos");const o=await a.json();i.value=o.offers.map(n=>({...n,pctFormatted:`${(parseFloat(n.pct)-1)*100}%`})),x.value=o.total_records||0,M(t,{products:i.value,totalRecords:x.value}),console.log("Dados salvos no cache"),d.value=!1}const M=(t,e)=>{const a=`page_cache_offers_leroy_${t}`,o={data:e,timestamp:Date.now()};sessionStorage.setItem(a,JSON.stringify(o))},G=(t,e)=>{const a=sessionStorage.getItem(`page_cache_offers_leroy_${t}`);if(!a)return null;const{data:o,timestamp:n}=JSON.parse(a);return Date.now()-n>e?null:o},J=async t=>{const{newData:e,index:a}=t,o=i.value[a];if(o.link!==e.link){const n=o.sku,c=o.order_id,f=e.link,F=await updateLink(n,c,f);i.value[a].link=F.link}};async function K(t){const e=t.link,a=t.sku_1,o=t.ean;try{const n=await L(e,a,o),c=i.value.findIndex(f=>f.ean===t.ean);c!==-1&&(i.value[c].stock=n.stock,i.value[c].data_atualizacao=n.data_atualizacao,i.value[c].price=n.price,i.value[c].price_sale=n.price_sale,O.add({severity:"success",summary:"Stock Atualizado",detail:`O stock foi atualizado para ${n.stock}`,group:"br",life:3e3}))}catch(n){O.add({severity:"error",summary:"Erro ao Atualizar Stock",detail:n,group:"br",life:3e3})}}const q=async t=>{if(!t.trim()){b(1);return}const e=await fetch(`${S}/offers/search?query=${encodeURIComponent(t)}`,{method:"GET",credentials:"include"});if(e.redirected||e.status===302||e.status===401){window.location.href="/login";return}if(!e.ok)throw new Error("Erro ao buscar produtos");const a=await e.json();i.value=a.offers.map(o=>({...o,pctFormatted:`${(parseFloat(o.pct)-1)*100}%`})),x.value=a.total_records||0,console.log(i.value),console.log("Dados salvos no cache"),d.value=!1},H=t=>{$.value=t.page+1,b($.value)},Q=()=>{b($.value)};ee(()=>{b(1)});const I=t=>t.toLocaleString("de-DE",{style:"currency",currency:"EUR"});return(t,e)=>{const a=h("SelectButton"),o=h("InputIcon"),n=h("InputText"),c=h("IconField"),f=h("Skeleton"),F=h("Card"),W=h("Toast"),X=h("ScrollTop");return l(),v(P,null,[r(Y),_("div",ne,[r(a,{modelValue:z.value,"onUpdate:modelValue":e[0]||(e[0]=s=>z.value=s),options:A.value},null,8,["modelValue","options"])]),r(F,{style:{margin:"auto 1.5rem"}},{content:p(()=>[z.value==="Ofertas"?(l(),v("div",re,[r(y(oe),{value:d.value?U.value:i.value,onSort:B,sortField:T.value,sortOrder:j.value,dataKey:"sku_1",editMode:"row",onRowEditSave:J,paginator:!0,rows:N,totalRecords:x.value,lazy:!0,size:"normal",removableSort:"",onPage:H,pt:{table:{style:"min-width: 30rem"},cell:{style:"padding: 0 !important"},column:{bodycell:({state:s})=>s.loading?{style:"opacity: 0.5"}:{}}}},{header:p(()=>[_("div",le,[_("div",ie,[_("div",ce,[r(c,null,{default:p(()=>[r(o,null,{default:p(()=>e[5]||(e[5]=[_("i",{class:"pi pi-search"},null,-1)])),_:1}),r(n,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=s=>C.value=s),id:"search",name:"search",type:"text",placeholder:"Pesquisar",variant:"filled",fluid:""},null,8,["modelValue"])]),_:1}),r(y(D),{type:"submit",severity:"contrast",icon:"pi pi-search",onClick:e[2]||(e[2]=s=>q(C.value))})])]),_("div",de,[r(y(D),{icon:"pi pi-refresh",severity:"contrast",size:"small",rounded:"",raised:"",onClick:Q})])])]),default:p(()=>[r(y(w),{field:"image_url",header:"imagem",style:{"min-width":"50px","max-width":"60px","align-self":"center"}},{body:p(({data:s,field:u})=>[d.value?(l(),k(f,{key:0,style:{margin:"2px"}})):(l(),v("img",{key:1,src:s.image_url,alt:s.name,class:"w-24 rounded"},null,8,ue))]),_:1}),r(y(w),{field:"name",header:"produto",style:{"min-width":"150px","max-width":"360px","align-self":"center"}},{body:p(({data:s,field:u})=>[d.value?(l(),k(f,{key:0,style:{margin:"2px"}})):(l(),v(P,{key:1},[_("a",{href:s.link,target:"_blank",rel:"noopener noreferrer"},g(s[u]),9,pe),_("p",fe,"EAN: "+g(s.ean),1),_("p",me,"SKU: "+g(s.sku_1),1)],64))]),_:1}),r(y(w),{field:"data_atualizacao",header:"Ultima Atualização",style:{"min-width":"80px","max-width":"120px","align-self":"center"}},{body:p(({data:s,field:u})=>[d.value?(l(),k(f,{key:0,style:{margin:"2px"}})):(l(),v("span",ye,g(s[u]),1))]),_:1}),r(y(w),{field:"price",header:"Original Price",style:{"min-width":"90px","max-width":"60px","align-self":"center"}},{body:p(({data:s,field:u})=>[d.value?(l(),k(f,{key:0,style:{margin:"2px"}})):(l(),v("span",_e,g(I(s[u])),1))]),_:1}),r(y(w),{field:"price_sale",header:"Sale Price",style:{"min-width":"90px","max-width":"60px","align-self":"center"}},{body:p(({data:s,field:u})=>[d.value?(l(),k(f,{key:0,style:{margin:"2px"}})):(l(),v("span",ve,g(I(s[u])),1))]),_:1}),r(y(w),{field:"pctFormatted",header:"Margem %",style:{"min-width":"80px","max-width":"60px","align-self":"center"}},{body:p(({data:s,field:u})=>[d.value?(l(),k(f,{key:0,style:{margin:"2px"}})):(l(),v("span",he,g(s[u]),1))]),_:1}),r(y(w),{field:"stock",header:"Stock",style:{"min-width":"50px","max-width":"60px","align-self":"center"}},{body:p(({data:s,field:u})=>[d.value?(l(),k(f,{key:0,style:{margin:"20px"}})):s[u]!=null?(l(),v("div",ge,[_("span",we,g(s[u]),1),r(y(se),{icon:"pi pi-fw pi-sync",severity:"Primary",rounded:"",style:{cursor:"pointer","text-align":"center",margin:"0 5px","background-color":"white",transition:"background-color 0.3s"},onClick:R=>K(s),onMouseover:e[3]||(e[3]=R=>E.value=!0),onMouseleave:e[4]||(e[4]=R=>E.value=!1),class:ae({"tag-hover":E.value})},null,8,["onClick","class"])])):V("",!0)]),_:1})]),_:1},8,["value","sortField","sortOrder","totalRecords","pt"])])):V("",!0)]),_:1}),r(W,{position:"bottom-right",group:"br"}),r(X,{severity:"contrast"})],64)}}};export{$e as default};
